"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createSignatureVerifier = void 0;
const createSignatureVerifier = ({ sha256, jwtVerify, secret }) => {
    return (signature, request) => {
        try {
            const payload = jwtVerify(signature, secret);
            const isValid = payload.hmac ===
                sha256(JSON.stringify({
                    url: request.url,
                    method: request.method,
                    body: JSON.parse(request.body),
                }));
            if (!isValid) {
                throw new Error('Invalid signature. HMAC does not match');
            }
            return payload;
        }
        catch (exception) {
            throw new Error('Invalid signature. ' + exception.message);
        }
    };
};
exports.createSignatureVerifier = createSignatureVerifier;
//# sourceMappingURL=verifySignature.js.map